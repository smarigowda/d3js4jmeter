<!DOCTYPE html>
<!-- 

    jtl file has to be renamed as .xml
    
    Function:
    
    > Read the xml file
    > Filter requests with some criteria. Ex: Filter all HTTP requests having > 5000 ms response time

-->
<meta charset="utf-8">

<body>
<script src="/js/d3.v3.min.js"></script>
<script src="/js/underscore.js"></script>

<!-- <script src="../../crossfilter/crossfilter.js"></script> -->

<script>

var gdata;
var results;

// get the file name from URL
// aggregate_report3.csv
var file_name = GetUrlValue('file_name');
var folder_name = GetUrlValue('folder_name');
d3.xml("./data/".concat(folder_name, "/", file_name), function(data) {
		console.log('data read');
        
        gdata = data;
        
        console.log(data); // an array of objects, type of Document
        // gdata.__proto__; // Document
        
        result_1 = d3.select(gdata).selectAll("sample");
        console.log(result_1);
        
        //results = d3.select(gdata).selectAll("*")
        results2 = d3.select(gdata).selectAll("httpSample")[0]; // an array of all http samples
        
        results3 = d3.select(gdata).selectAll("sample")[0]; // an array of all samples
        
        console.log(results3);
        
        // results3.map(function(d) {return d.attributes.lb.value})
        // results3.map(function(d) {return d.attributes.t.value})
        
        console.log(results2);
        
        xml2array = _.map(results2, function(d) { return d } ) // this convers from xml to JavaScript Array Object
        
        results = _.filter(results2, function(d) {return d.attributes.t.value > 2500}) // nested array of objects, JSON
         
        d3.select("body").selectAll("p").data(results).enter().append("p").text(function(d,i) { /*console.log(d.attributes.lb.value);*/ return d.attributes.lb.value + ' - ' + d.attributes.t.value + ' msec'; })
        
        //d3.select("body").selectAll("p").data(results).enter().append("p").text(function(d,i) { /*console.log(d.attributes.lb.value);*/ return d.attributes.t.value; })
        
        
});


// A function to get the value of a key from the URL query string
function GetUrlValue(VarSearch){
    var SearchString = window.location.search.substring(1);
    var VariableArray = SearchString.split('&');
    // loop through each of the URL parameters, split and check
    for(var i = 0; i < VariableArray.length; i++){
        var KeyValuePair = VariableArray[i].split('=');
        if(KeyValuePair[0] == VarSearch){
            return KeyValuePair[1];
        }
    }
}

</script>
