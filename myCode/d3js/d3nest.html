<!DOCTYPE html>
<meta charset="utf-8">

<style>

rect:hover {
        fill: orange;
}

body {
  font: 10px sans-serif;
}

.axis path,
.axis line {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}

.bar {
  fill: steelblue;
}

.x.axis path {
  display: none;
}

</style>


<body>

<div id="data_table">

</div>

<script src="/js/d3.v3.min.js"></script>
<script src="/js/underscore.js"></script>
<!-- <script src="../../crossfilter/crossfilter.js"></script> -->

<script>

var testResults;
var elapsedTime = [ ];
var finalApdex = [ ];
var apdexT = 10000000;
var apdexFourT = apdexT * 4;
var apdexTable = [ ];
var d3jsentries;

// get the file name from URL
// aggregate_report3.csv
var file_name = GetUrlValue('file_name');
var folder_name = GetUrlValue('folder_name');
d3.csv(["./data/", folder_name, "/", file_name, "/"].join(''), function(data) {
       
		console.log('csv data in d3js');
        //console.log(data);
		
        // filter the row having label as "TOTAL"
        
        data_2  = _.filter(data, function(d) { return d.sampler_label !== "TOTAL"} );
        
        console.log ( data_2 );
        
        console.log(_.keys(data_2[0]));
        
        // data_3  = _.filter(data_2, function(d) { return d.sampler_label == "TOTAL"} ); // for test
        
		//console.log('grouped by label and perform average of elapsed time and percentile for each label');
		/*groupbyLabel = d3.nest()
				 .key(function(d) { return d.label; })
				 .sortKeys(d3.ascending)
				 .entries(data); */


       /* groupbyLabel = d3.nest()
            .key(function(d) { return d.label; })
            //.sortKeys(d3.ascending)
            .rollup(function(d) {
                console.log(d);
                console.log(_.pluck(d, 'elapsed').map(function(d2) {return +d2}));
                return {
                    avg_elapsed: d3.mean(d, function(g) { return +g.elapsed; }),
                    percentile90: d3.quantile(_.pluck(d, 'elapsed').map(function(d2) {return +d2}), 0.75)
                }
            })
            .entries(data);

        console.log('groupbyLabel');
		console.log(groupbyLabel); */
        
        
        d3.select("#data_table")
                .append("table")
                .attr("border", "0")
                .append("tr")
                .selectAll("th")
                .data(_.keys(data_2[0]))
                .enter()
                .append("th")
                .text(function(d) { return d});
                
                
        d3.select("#data_table table")
            
            .data(data_2)
            .append("tr")
            .selectAll("td")
            
            .enter()
            .append("td")
            .text("cell");
               
});

// A function to get the value of a key from query string
function GetUrlValue(VarSearch){
    var SearchString = window.location.search.substring(1);
    var VariableArray = SearchString.split('&');
    for(var i = 0; i < VariableArray.length; i++){
        var KeyValuePair = VariableArray[i].split('=');
        if(KeyValuePair[0] == VarSearch){
            return KeyValuePair[1];
        }
    }
}

</script>

</body>
