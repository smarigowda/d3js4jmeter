<!DOCTYPE html>
<meta charset="utf-8">

<style>

rect:hover {
        fill: orange;
}

body {
  font: 10px sans-serif;
}

.axis path,
.axis line {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}

.bar {
  fill: steelblue;
}

.x.axis path {
  display: none;
}

</style>


<body>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="http://underscorejs.org/underscore.js"></script>
<!-- <script src="../../crossfilter/crossfilter.js"></script> -->

<script>

var testResults;
var elapsedTime = [ ];
var finalApdex = [ ];
var apdexT = 10000000;
var apdexFourT = apdexT * 4;
var apdexTable = [ ];
var d3jsentries;

// get the file name from URL
// aggregate_report3.csv
var file_name = GetUrlValue('file_name');
d3.csv("./data/".concat(file_name), function(data) {
        testResults = data;
		console.log('csv data in d3js');
        console.log(testResults);
		
		console.log('grouped by label and perform average of elapsed time and percentile for each label');
		/*groupbyLabel = d3.nest()
				 .key(function(d) { return d.label; })
				 .sortKeys(d3.ascending)
				 .entries(data); */


        groupbyLabel = d3.nest()
            .key(function(d) { return d.label; })
            //.sortKeys(d3.ascending)
            .rollup(function(d) {
                console.log(d);
                console.log(_.pluck(d, 'elapsed').map(function(d2) {return +d2}));
                return {
                    avg_elapsed: d3.mean(d, function(g) { return +g.elapsed; }),
                    percentile90: d3.quantile(_.pluck(d, 'elapsed').map(function(d2) {return +d2}), 0.75)
                }
            })
            .entries(data);

        console.log('groupbyLabel');
		console.log(groupbyLabel);
});

// A function to get the value of a key from query string
function GetUrlValue(VarSearch){
    var SearchString = window.location.search.substring(1);
    var VariableArray = SearchString.split('&');
    for(var i = 0; i < VariableArray.length; i++){
        var KeyValuePair = VariableArray[i].split('=');
        if(KeyValuePair[0] == VarSearch){
            return KeyValuePair[1];
        }
    }
}

</script>
